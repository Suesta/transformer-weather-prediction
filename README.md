# ğŸŒ¦ï¸ transformer-weather-prediction

Time series temperature forecasting using a Transformer-based Seq2Seq model with ARIMA residual adjustment.

## ğŸ§  Model Summary

This project implements a hybrid forecasting pipeline for daily average temperatures across 21 European cities.  
The core model is a Transformer-based Sequence-to-Sequence (Seq2Seq) architecture trained on sliding windows of historical meteorological data.  
To enhance long-term accuracy, final predictions are corrected using an ARIMA model fitted on the residuals.

## âš™ï¸ Architecture

- **Encoder-Decoder Transformer** with positional encoding and autoregressive decoding  
- Input sequence: 45-day historical window + seasonal lags (weekly and yearly)  
- Output sequence: 7-day forward temperature forecast  
- **Residual correction**: ARIMA(1,0,1)(1,1,1)[7] fitted on the last year of training residuals

## ğŸ› ï¸ Technologies Used

- Python Â· PyTorch Â· scikit-learn Â· statsmodels  
- Custom DataLoader, Early Stopping, Learning Rate Scheduling  
- Evaluation metrics: MAE, RMSE, and RÂ²

## ğŸ“Š Results (Test Set)

- **MAE**: 2.36 Â°C  
- **RMSE**: 3.02 Â°C  
- **RÂ²**: 0.88

## ğŸ–¼ï¸ Forecast Samples

Below are sample 7-day forecasts generated by the deployed model via FastAPI:

<p align="center">
  <img src="figures/barcelona_forecast.png" alt="Barcelona Forecast" width="400"/>
  <img src="figures/madrid_forecast.png" alt="Madrid Forecast" width="400"/>
  <img src="figures/murmansk_forecast.png" alt="Murmansk Forecast" width="400"/>
  <img src="figures/reikiavik_forecast.png" alt="Reikiavik Forecast" width="400"/>
</p>

These forecasts demonstrate how the model adapts to diverse climatic profiles across Europe.

## ğŸ“ Repository Contents

- `transformer_weather_forecasting.py`: Full pipeline for preprocessing, training, evaluation, and ARIMA correction  
- `weather_api.py`: FastAPI-based endpoint for real-time temperature prediction  
- `modelo_final.pth`: Trained model weights (see link below)  
- `datos_combinados.csv`: Preprocessed input dataset  
- `resultados_mejorado.png`: Final prediction vs actual scatter plot  
- `figures/`: Folder with forecast result visualizations

## ğŸ“¦ Download Trained Model

ğŸ”— You can download the trained model weights here:  
ğŸ‘‰ [modelo_final.pth (Google Drive)](https://drive.google.com/file/d/1ziS0eqpvQCVH8lnDZmApKUwZIavyKQaa/view?usp=sharing)

> This file is hosted externally to comply with GitHub storage guidelines.

## âš™ï¸ Installation

Clone the repository and install the required dependencies:

```bash
git clone https://github.com/Suesta/transformer-weather-prediction.git
cd transformer-weather-prediction
pip install -r requirements.txt
````

## ğŸš€ Usage

### Option A â€” Train from scratch

```bash
python transformer_weather_forecasting.py
```

This will preprocess the data, train the Transformer model with ARIMA correction, and save:

* The trained weights (`modelo_final.pth`)
* The performance plots (`resultados_mejorado.png`)

### Option B â€” Use pretrained model

Download the pretrained weights from the link above and load them:

```python
import torch
from transformer_weather_forecasting import TransformerSeq2Seq, Config

model = TransformerSeq2Seq(input_size=32, cfg=Config())
model.load_state_dict(torch.load("modelo_final.pth", map_location="cpu"))
model.eval()
```

## ğŸŒ API Deployment

Run the FastAPI service for real-time predictions:

```bash
uvicorn weather_api:app --reload
```

Once running, the API will be available at:
ğŸ‘‰ `http://127.0.0.1:8000/docs` (Swagger UI with interactive documentation)

## ğŸ“– Citation

If you use this repository in your research or projects, please cite:

```
Suesta, VÃ­ctor. (2025). Transformer Weather Prediction with ARIMA Residual Correction.
```

---

## ğŸ”— Author
VÃ­ctor Suesta  
[LinkedIn](https://www.linkedin.com/in/vÃ­ctor-suesta-arribas-7b1250322/)

Â© VÃ­ctor Suesta â€” 2025

```

---

Â¿Quieres que te prepare tambiÃ©n el archivo `requirements.txt` exacto (con versiones estables de PyTorch, scikit-learn, statsmodels, etc.) para que tu repo quede totalmente reproducible?
```
